<?xml version="1.0" encoding="ISO-8859-1"?>
<modification>
  <id>ControleInterno</id>
  <name>Controle Interno</name>
  <ecidade-version>2.3.36</ecidade-version>
  <file path='model/agendaPagamento.model.php'>
    <operation>
      <search><![CDATA[/*[Extensao] - Controle Interno*/]]></search>
      <add position="after">
        <![CDATA[
    $sWhere .= " and (exists(select 1 from plugins.empenhonotacontroleinterno ";
    $sWhere .= "              where nota = e71_codnota and situacao >= " . ControleInterno::SITUACAO_LIBERADO_DIRETOR . ")";
    $sWhere .= ")";
          ]]>
      </add>
    </operation>
  </file>

  <file path='classes/empenho.php'>
    <operation>
      <search><![CDATA[/*[Extensao] - Controle Interno Parte 1*/]]></search>
      <add position="after">
        <![CDATA[
    $this->analiseAutomaticaControleInterno($codnota, $o56_elemento, $numemp);
          ]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[/*[Extensao] - Controle Interno Parte 2*/]]></search>
      <add position="after">
        <![CDATA[
    /**
   * Verifica se deve fazer análise automática da liquidação do empenho e realiza a aprovação, se for o caso.
   *
   * @param integer $iCodigoNota    Código da nota de liquidação do empenho.
   * @param string  $sEstrutural    Estrutural do empenho.
   * @param integer $iNumeroEmpenho Número do empenho.
   *
   * @throws Exception
   */
  private function analiseAutomaticaControleInterno($iCodigoNota, $sEstrutural, $iNumeroEmpenho) {

    if (!ControleInterno::verificaAnaliseAutomatica($sEstrutural)) {
      return;
    }

    $sCampos = " e69_codnota, e60_vlremp, e60_vlrliq, e60_vlranu ";
    $sOrdem  = " e69_codnota ";
    $sWhere  = " e69_numemp = {$iNumeroEmpenho} ";

    $oDaoEmpNota = new cl_empnota();
    $sSqlEmpNota = $oDaoEmpNota->sql_query_valor_financeiro(null, $sCampos, $sOrdem, $sWhere);
    $rsEmpNota   = $oDaoEmpNota->sql_record($sSqlEmpNota);

    //Se não tiver liquidações para o empenho, é o primeiro, então não deve aprovar automaticamente.
    if ($oDaoEmpNota->numrows < 1) {
      return;
    }

    $oEmpNota = db_utils::fieldsMemory($rsEmpNota, 0);

    //Primeira nota, não deve aprovar automaticamente.
    if ($oEmpNota->e69_codnota == $iCodigoNota) {
      return;
    }

    // Última liquidação (liquidou tudo), não deve aprovar automaticamente.
    if ($oEmpNota->e60_vlremp - $oEmpNota->e60_vlrliq  - $oEmpNota->e60_vlranu == 0) {
      return;
    }

    //Verifica se a primeira liquidação já foi liberada.
    $oControleInternoPrimeiraLiquidacao = new ControleInternoMovimento($oEmpNota->e69_codnota);
    if ($oControleInternoPrimeiraLiquidacao->getSituacaoFinal() < ControleInterno::SITUACAO_LIBERADO_DIRETOR) {
      return;
    }

    //Cria uma aprovação automática.
    $oControleInterno = new ControleInternoMovimento($iCodigoNota);
    $oControleInterno->criaAutorizacaoAutomatica();
  }
          ]]>
      </add>
    </operation>

    <operation>
      <search><![CDATA[/** [Extensao - Controle Interno - Estorno de Liquidação] */]]></search>
      <add position="after">
        <![CDATA[
    $oPlugin = new Plugin(null, 'ControleInterno');
    $aConfiguracoes = PluginService::getPluginConfig($oPlugin);
    
    if ($aConfiguracoes['ValidaEstornoLiquidacao'] == 't') {

      if (ControleInterno::liberado($codnota)) {
  
         $this->erro_status  = '0';
         $this->erro_msg     = "A nota {$codnota} encontra-se liberada pelo Controle Interno.\n\n";
         $this->erro_msg    .= "Para realizar o estorno desta liquidação, a liberação da nota deverá ser cancelada pelo Controle Interno.";
         return false;
      }
    }
          ]]>
      </add>

    </operation>

    <operation>
      <search><![CDATA[      if ( $e69_dtnota < $oDataEmpenho->e60_emiss ) {
        $this->lSqlErro = true;
        $this->sMsgErro = "Data da nota inferior a data do empenho!";
        return false;
      }]]></search>
      <add position="replace">
        <![CDATA[     $oPlugin = new Plugin(null, 'ControleInterno');
     $aConfiguracoes = PluginService::getPluginConfig($oPlugin);
     if ( $e69_dtnota < $oDataEmpenho->e60_emiss && $aConfiguracoes['ValidaDataNotaLiquidacao'] == 't') {
        $this->lSqlErro = true;
        $this->sMsgErro = "Data da nota inferior a data do empenho!";
        return false;
      }]]>
      </add>
    </operation>
  </file>

  <file path='forms/db_frmliquidasemordem.php'>
    <operation>
      <search><![CDATA[require_once("libs/db_liborcamento.php");]]></search>
      <add position="replace">
        <![CDATA[require_once(modification("libs/db_liborcamento.php"));]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[<!--[Extensao LiquidacaoCompetencia] inclusao do campo -->]]></search>
      <add position="after">
        <![CDATA[
          <? 
           if ($operacao == 1) {
             echo "<tr>
                     <td> 
                      <strong>Mês de Competência:</strong> 
                     </td>
                     <td>";                
                       $mes_competencia = date("m", db_getsession("DB_datausu"));
                       db_select("mes_competencia", array_combine(range(1,12), range(1,12)), true, 1, "style='width: 50px;'");  

                       $ano_competencia = db_getsession("DB_anousu");
                       $ano_inicio = $ano_competencia - 2;
                       db_select("ano_competencia", array_combine(range($ano_inicio, $ano_competencia), range($ano_inicio, $ano_competencia)), true, 1, "style='width: 80px;'");  
             echo "  </td>
                   </tr>"; 
           } 
          ?>        ]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[/* [Inicio plugin LiquidacaoCompetencia] */]]></search>
      <add position="after">
        <![CDATA[
         if ($('mes_competencia')) {
           oParam.mes_competencia = $F('mes_competencia');
           var ano_competencia = document.getElementById('ano_competencia');
           oParam.ano_competencia = ano_competencia.options[ano_competencia.selectedIndex].innerHTML;          
         }
        ]]>
      </add>
    </operation>
  </file>
  <file path='forms/db_frmliquida.php'>
    <operation>
      <search><![CDATA[require_once("libs/db_liborcamento.php");]]></search>
      <add position="replace">
        <![CDATA[require_once(modification("libs/db_liborcamento.php"));]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[<!--[Extensao LiquidacaoCompetencia] inclusao do campo -->]]></search>
      <add position="after">
        <![CDATA[
          <? 
           if ($operacao == 1) {
             echo "<tr>
                     <td> 
                      <strong>Mês de Competência:</strong> 
                     </td>
                     <td>";                
                       $mes_competencia = date("m", db_getsession("DB_datausu"));
                       db_select("mes_competencia", array_combine(range(1,12), range(1,12)), true, 1, "style='width: 50px;'");  

                       $ano_competencia = db_getsession("DB_anousu");
                       $ano_inicio = $ano_competencia - 2;
                       db_select("ano_competencia", array_combine(range($ano_inicio, $ano_competencia), range($ano_inicio, $ano_competencia)), true, 1, "style='width: 80px;'");  
             echo "  </td>
                   </tr>"; 
           } 
          ?>
        ]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[/* [Inicio plugin LiquidacaoCompetencia] */]]></search>
      <add position="after">
        <![CDATA[
         if ($('mes_competencia')) {
           oParam.mes_competencia = $F('mes_competencia');
           var ano_competencia = document.getElementById('ano_competencia');
           oParam.ano_competencia = ano_competencia.options[ano_competencia.selectedIndex].innerHTML;          
         }
        ]]>
      </add>
    </operation>
  </file>
  <file path='emp4_liquidacao004.php'>
    <operation>
      <search><![CDATA[/* [Inicio plugin LiquidacaoCompetencia] */]]></search>
      <add position="after">
        <![CDATA[
         $oLiquidacaoCompetencia = db_utils::getDao("liquidacaocompetencia");
         foreach ($aOrdensGeradas as $iIndOrdensGeradas => $iOrdem) {
           $oLiquidacaoCompetencia->pagordem = $iOrdem;
           $oLiquidacaoCompetencia->mes   = $objJson->mes_competencia;
           $oLiquidacaoCompetencia->ano   = $objJson->ano_competencia;
           $oLiquidacaoCompetencia->incluir(null);
           if ($oLiquidacaoCompetencia->erro_status == 0) {
              throw new Exception($oLiquidacaoCompetencia->erro_msg);
           }
         } 
        ]]>
      </add>
    </operation>
    <operation>
      <search><![CDATA[/* [Inicio plugin LiquidacaoCompetencia - SemOrdem] */]]></search>
      <add position="after">
        <![CDATA[
          $oLiquidacaoCompetencia = db_utils::getDao("liquidacaocompetencia");
          $oLiquidacaoCompetencia->pagordem = $oDadosRetorno->e50_codord;
          $oLiquidacaoCompetencia->mes   = $objJson->mes_competencia;
          $oLiquidacaoCompetencia->ano   = $objJson->ano_competencia;
          $oLiquidacaoCompetencia->incluir(null);
          if ($oLiquidacaoCompetencia->erro_status == 0) {
            throw new Exception($oLiquidacaoCompetencia->erro_msg);
          }
        ]]>
      </add>
    </operation>

    <operation>
      <search><![CDATA[ClassificacaoCredor::validaDatas($oEmpenho, $oDataNota, $oDataRecebimento, $oDataVencimento);]]></search>
      <add position="replace">
        <![CDATA[     $oPlugin = new Plugin(null, 'ControleInterno');
     $aConfiguracoes = PluginService::getPluginConfig($oPlugin);
     if ($aConfiguracoes['ValidaDataNotaLiquidacao'] == 't') {
       ClassificacaoCredor::validaDatas($oEmpenho, $oDataNota, $oDataRecebimento, $oDataVencimento);
     }]]>
      </add>
    </operation>
  </file>

  <file path='emp1_lancaretencoes001.php'>
    <operation>
      <search><![CDATA[var sJson = '{"exec":"getMovimentos","params":['+sParam+']}'; ]]></search>
      <add position="replace">
        <![CDATA[var sJson = '{"exec":"getMovimentosParaRetencao","params":['+sParam+']}'; ]]>
      </add>
    </operation>
  </file>

  <file path='emp4_configuracaoarquivoenvio001.php'>
    <operation>
      <search><![CDATA[$('btnGerarArquivoTXT').observe('click', function() {
  window.location = 'emp4_empageconfgera001.php';
});]]></search>
      <add position="replace">
        <![CDATA[$('btnGerarArquivoTXT').observe('click', function() {
  window.location = 'emp4_empageconfgera001.php?geraUnidade';
});]]>
      </add>
    </operation>
  </file>

  <file path='func_empnota001.php'>
    <operation>
      <search><![CDATA[  $sSqlNotasLiq .= "       e69_dtnota,  ";]]></search>
      <add position="after">
        <![CDATA[
  $sSqlNotasLiq .= "(case situacao";       
  $sSqlNotasLiq .= "    when 1 then 'Aguardando Análise'";       
  $sSqlNotasLiq .= "    when 2 then 'Rejeitado Analista'";
  $sSqlNotasLiq .= "    when 3 then 'Liberado Analista'";
  $sSqlNotasLiq .= "    when 4 then 'Rejeitado Diretor'";
  $sSqlNotasLiq .= "    when 5 then 'Liberado Diretor'";
  $sSqlNotasLiq .= "    when 6 then 'Análise Automática'";       
  $sSqlNotasLiq .= "    else 'Sem análise' end)  as dl_Situação,   ";]]>
      </add>
    </operation>

    <operation>
      <search><![CDATA[  $sSqlNotasLiq .= "       left  join pagordemele  on e71_codord  = e53_codord  ";]]></search>
      <add position="after">
        <![CDATA[
  $sSqlNotasLiq .= "       left  join plugins.empenhonotacontroleinterno on nota = e69_codnota ";]]>
      </add>
    </operation>
  </file>

  <file path='emp4_manutencaoPagamentoRPC.php'>
    <operation>
      <search><![CDATA[/* [Extensao ControleInterno] - Nova funcao para listar movimentos para retencoes */]]></search>
      <add position="after">
        <![CDATA[
  case "getMovimentosParaRetencao" :

    $oAgenda = new agendaPagamento();
    $oAgenda->setUrlEncode(true);
    $sJoin   = '';
    $sWhereIni  = " ((round(e53_valor,2)-round(e53_vlranu,2)-round(e53_vlrpag,2)) > 0 ";
    $sWhereIni .= " and (round(e60_vlremp,2)-round(e60_vlranu,2)-round(e60_vlrpag,2)) > 0) ";
    $sWhereIni .= " and corempagemov.k12_codmov is null and e81_cancelado is null";
    $sWhereIni .= " and e80_data  <= '".date("Y-m-d",db_getsession("DB_datausu"))."'";
    $sWhereIni .= " and e60_instit = ".db_getsession("DB_instit");
    $sWhere     = $sWhereIni;
    $oAgenda->setOrdemConsultas("e82_codord, e81_codmov");
    if ($oParam->params[0]->iOrdemIni != '' && $oParam->params[0]->iOrdemFim == "") {
      $sWhere .= " and e50_codord = {$oParam->params[0]->iOrdemIni}";
    } else if ($oParam->params[0]->iOrdemIni != '' && $oParam->params[0]->iOrdemFim != "") {
      $sWhere .= " and e50_codord between  {$oParam->params[0]->iOrdemIni} and {$oParam->params[0]->iOrdemFim}";
    }

    if ($oParam->params[0]->dtDataIni != "" && $oParam->params[0]->dtDataFim == "") {
      $sWhere .= " and e50_data = '".implode("-",array_reverse(explode("/",$oParam->params[0]->dtDataIni)))."'";
    } else if ($oParam->params[0]->dtDataIni != "" && $oParam->params[0]->dtDataFim != "") {

      $dtDataIni = implode("-",array_reverse(explode("/",$oParam->params[0]->dtDataIni)));
      $dtDataFim = implode("-",array_reverse(explode("/",$oParam->params[0]->dtDataFim)));
      $sWhere .= " and e50_data between '{$dtDataIni}' and '{$dtDataFim}'";

    } else if ($oParam->params[0]->dtDataIni == "" && $oParam->params[0]->dtDataFim != "") {

      $dtDataFim  = implode("-",array_reverse(explode("/",$oParam->params[0]->dtDataFim)));
      $sWhere    .= " and e50_data <= '{$dtDataFim}'";
    }

    if ($oParam->params[0]->iCodEmp!= '') {
      if (strpos($oParam->params[0]->iCodEmp,"/")) {
        $aEmpenho = explode("/",$oParam->params[0]->iCodEmp);
        $sWhere .= " and e60_codemp = '{$aEmpenho[0]}' and e60_anousu={$aEmpenho[1]}";
      } else {
        $sWhere .= " and e60_codemp = '{$oParam->params[0]->iCodEmp}' and e60_anousu=".db_getsession("DB_anousu");
      }
    }

    $sCredorCgm = '';

    if ($oParam->params[0]->iNumCgm != '') {

      $sWhere    .= " and (e60_numcgm = {$oParam->params[0]->iNumCgm})";
      $sCredorCgm = $oParam->params[0]->iNumCgm;
    }
    if ($oParam->params[0]->iAutorizadas == 2) {

      $lAutorizadas      = true;
      if ($oParam->params[0]->sDtAut != "") {

        $sDtAut   = implode("-", array_reverse(explode("/", $oParam->params[0]->sDtAut)));
        $sWhere .= " and e42_dtpagamento = '{$sDtAut}'";

      }

      $sWhere .= " and e43_autorizado is true ";

    } else if ($oParam->params[0]->iAutorizadas == 3) {

      $sWhere .= " and e43_empagemov is null";
    }

    if ($oParam->params[0]->iOPauxiliar != '') {

      $sWhere .= " and e42_sequencial = {$oParam->params[0]->iOPauxiliar}";
    }
    if ($oParam->params[0]->iRecurso != '') {

      $sWhere .= " and o15_codigo = {$oParam->params[0]->iRecurso}";
    }
    if ($oParam->params[0]->iOPManutencao != '') {

      $sWhere .= " or ( e42_sequencial = {$oParam->params[0]->iOPManutencao}  and $sWhereIni)";
      $oAgenda->setOrdemConsultas("e42_sequencial,e43_sequencial, e81_codmov,e50_codord");

    } else if (!empty($oParam->params[0]->e03_numeroprocesso)) {

      $sProcesso = addslashes(db_stdClass::normalizeStringJson($oParam->params[0]->e03_numeroprocesso));
      $sWhere   .= " and e03_numeroprocesso = '{$sProcesso}'";
    }

    $sJoin   .= " left join empagenotasordem on e81_codmov         = e43_empagemov  ";
    $sJoin   .= " left join empageordem      on e43_ordempagamento = e42_sequencial ";
    $sJoin   .= " left join pagordemprocesso on e50_codord = e03_pagordem ";

    if (property_exists($oParam->params[0], 'orderBy') && $oParam->params[0]->orderBy == "cgm.z01_nome") {
      $oAgenda->setOrdemConsultas("case when trim(a.z01_nome)   is not null then a.z01_nome   else cgm.z01_nome end");
    }

    if (!empty($oParam->params[0]->codigo_classificacao)) {

      $sJoin  .= " left join classificacaocredoresempenho on cc31_empempenho = e60_numemp ";
      $sWhere .= " and cc31_classificacaocredores = {$oParam->params[0]->codigo_classificacao} ";
    }

    if (!empty($oParam->params[0]->data_vencimento)) {

      $oDataVencimento = new DBDate($oParam->params[0]->data_vencimento);
      $sWhere .= " and e69_dtvencimento = '{$oDataVencimento->getDate()}'";
    }

    $aOrdensAgenda = $oAgenda->getMovimentosAgendaParaRetencao($sWhere,$sJoin,$lTrazContasFornecedor , $lTrazContasRecurso,'',$oParam->params[0]->lVinculadas, $sCredorCgm);

    if (!empty($oParam->params[0]->lTratarMovimentosConfigurados) && $oParam->params[0]->lTratarMovimentosConfigurados) {

      $aMovimentosConfigurados = array();
      foreach ($aOrdensAgenda as $oStdMovimento) {

        if ($oStdMovimento->e91_codmov != "" || $oStdMovimento->e90_codmov != "") {
          continue;
        } else {
          $aMovimentosConfigurados[] = $oStdMovimento;
        }
      }
      $aOrdensAgenda = $aMovimentosConfigurados;
    }


    $oRetono->status           = 2;
    $oRetono->mensagem         = "";
    $oRetono->aNotasLiquidacao = array();
    if (count($aOrdensAgenda) > 0) {

      $oRetono->status           = 1;
      $oRetono->mensagem         = 1;
      $oRetono->totais           = $oAgenda->getTotaisAgenda($sWhere);
      $oRetono->aNotasLiquidacao = $aOrdensAgenda;
    }
    echo $oJson->encode($oRetono);
    
    break;]]>
      </add>
    </operation>
  </file>

  <file path='model/agendaPagamento.model.php'>
    <operation>
      <search><![CDATA[/* [Extensao ControleInterno] - Nova funcao para listar movimentos para retencoes */]]></search>
      <add position="after">
        <![CDATA[
  function getMovimentosAgendaParaRetencao($sWhere = null, $sJoin, $lTrazfornecedor = true, $lTrazContaPagadora = true,$sCamposAdicionais='', $lVinculadas=true, $sCredorCgm = null) {

    $sOrderBy = "e81_codmov, e50_codord";
    if ($this->orderBy != null) {
      $sOrderBy = $this->orderBy;
    }

    $sWhereFiltroCgm = '';
    if (!empty($sCredorCgm)) {
      $sWhereFiltroCgm = " and empempenho.e60_numcgm = {$sCredorCgm} ";
    }
    $oDaoEmpAgeMov  = new cl_pagordem;

    /* [Extensão] - Filtro da Despesa */
    $sDotacoes = PermissaoUsuarioEmpenho::getDotacoesPorAnoDoUsuario(
      db_getsession('DB_id_usuario'),
      db_getsession('DB_anousu'),
      PermissaoUsuarioEmpenho::PERMISSAO_MANUTENCAO
    );
    if (!empty($sDotacoes)) {
      $sWhere .= " and {$sDotacoes} ";
    }

    $sSqlMovimentos = $oDaoEmpAgeMov->sql_query_empagemovforma(
      null,
      "
      empagemov.e81_codmov,
      (select e25_empagetipotransmissao from empagemovtipotransmissao where e25_empagemov = e81_codmov limit 1) as e25_empagetipotransmissao,
      (select fatura 
         from plugins.empagemovtipotransmissaofatura 
              inner join empagemovtipotransmissao on empagemovtipotransmissao = e25_sequencial 
        where e25_empagemov = e81_codmov 
        limit 1) as fatura,
      e80_codage,
      case when a.z01_numcgm       is not null then a.z01_numcgm else cgm.z01_numcgm end as z01_numcgm,
      case when trim(a.z01_nome)   is not null then a.z01_nome   else cgm.z01_nome   end as z01_nome,
      case when trim(a.z01_cgccpf) is not null then a.z01_cgccpf else cgm.z01_cgccpf end as z01_cgccpf,
      e50_data,
      e80_data,
      e60_anousu,
      e60_numemp,
      e60_codemp,
      o15_codigo,
      e86_data,
      e50_codord,
      e53_valor,
      o58_codigo,
      o58_orgao,
      o58_unidade,
      o58_localizadorgastos,
      e53_vlranu,
      k12_data,
      e91_cheque,
      e91_codmov,
      e71_codnota,
      e79_concarpeculiar,
      e60_concarpeculiar,
      (case when e85_codmov is null then
           (select e28_empagetipo
         from empageformacgm
        where e28_numcgm = e60_numcgm)
        else e85_codtipo end) as e85_codtipo,
      e97_codmov,
      e90_cancelado,
      case
        when e90_cancelado is true
          then null
        else e90_codmov
      end as e90_codmov,
      e98_contabanco,
      (case when e97_codforma is null then
       (select e97_codforma
              from empage
             INNER JOIN empagemov      ON empagemov.e81_codage = empage.e80_codage
             INNER JOIN empord         ON empord.e82_codmov = empagemov.e81_codmov
             INNER JOIN pagordem       ON pagordem.e50_codord = empord.e82_codord
             INNER JOIN pagordemele    ON pagordemele.e53_codord = pagordem.e50_codord
             INNER JOIN empempenho     ON empempenho.e60_numemp = pagordem.e50_numemp
             inner join empagemovforma on empagemovforma.e97_codmov   = empagemov.e81_codmov
             where empempenho.e60_instit = ".db_getsession("DB_instit") ."
                   {$sWhereFiltroCgm}
             order by e81_codmov desc limit 1)
        else e97_codforma end) as e97_codforma ,
      e42_dtpagamento,
      e53_vlrpag,
      round(e81_valor + (select coalesce(sum(e34_valordesconto), 0) from pagordemdesconto where e34_codord = e50_codord), 2) as e81_valor,
      e86_codmov,
      e43_sequencial,
      e42_sequencial,
      fc_validaretencoesmesanterior(e81_codmov,null) as validaretencao,
      fc_valorretencaomov(e81_codmov,false) as valorretencao,
      coalesce(e43_valor,0)  as e43_valor {$sCamposAdicionais}",
      $sOrderBy,
      $sWhere,
      $sJoin
    );

    $rsMovimento  = $oDaoEmpAgeMov->sql_record($sSqlMovimentos);
    $aNotas       = array();



    if ($oDaoEmpAgeMov->numrows > 0) {

      for ($iMovimentos = 0; $iMovimentos < $oDaoEmpAgeMov->numrows; $iMovimentos++) {

        $oMovimento        = db_utils::fieldsMemory($rsMovimento, $iMovimentos,false, false, $this->getUrlEncode());
        $oMovimento->validaretencao = $oMovimento->validaretencao=="t"?true:false;
        if ($lTrazContaPagadora) {
          $aContasVinculadas = $this->getContasRecurso($oMovimento->e50_codord, $lVinculadas);
          $oMovimento->aContasVinculadas = $aContasVinculadas;
        }
        if ($lTrazfornecedor) {
          $oMovimento->aContasFornecedor = $this->getContasFornecedor($oMovimento->z01_numcgm);
        }
        $aNotas[] = $oMovimento;
      }
    }


    return $aNotas;
  }]]>
      </add>
    </operation>
  </file>

</modification>
